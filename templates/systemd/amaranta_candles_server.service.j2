[Unit]
Description=Amaranta Candles Server Container
After=network.target

[Service]
Type=simple
TimeoutStartSec=60s
ExecStartPre=-/usr/bin/podman rm -f "amaranta_candles_server"
User=daniel

ExecStart=/usr/bin/podman run -t -a stdout -a stderr \
  -e allowed_hosts='{{ allowed_hosts }}' \
  -e deployment_mode='{{ deployment_mode }}' \
  -e secret_key='{{ secret_key }}' \
  -e sql_engine='{{ sql_engine }}' \
  -e sql_database='{{ sql_database }}' \
  -e sql_user='{{ sql_user }}' \
  -e sql_password='{{ sql_password }}' \
  -e sql_host='{{ sql_host }}' \
  -e sql_port='{{ sql_port }}' \
  -e ui_username='{{ ui_username }}' \
  -e ui_password='{{ ui_password }}' \
  -e ui_email='{{ ui_email }}' \
  --network host \
  --name amaranta_candles_server docker.pkg.github.com/banool/amaranta_candles/amaranta_candles_server:latest

ExecReload=-/usr/bin/podman stop "amaranta_candles_server"
ExecReload=-/usr/bin/podman rm "amaranta_candles_server"
ExecStop=-/usr/bin/podman stop "amaranta_candles_server"
Restart=always
RestartSec=60

[Install]
WantedBy=multi-user.target
